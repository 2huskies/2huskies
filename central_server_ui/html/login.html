<html>
    <head>
	<script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    </head>
    <body>
        <h1>login</h1>
        <form id="login-form">
	    <textarea id="login"></textarea><br>
	    <input id="password" type="password"></input><br>
            <input type="submit"></input>
        </form>
        <br>
        role: <span id="role"></span><br>
        abiturient_id: <span id="abiturient_id"></span><br>
        success: <span id="login-success"></span>
        debug: <span id="debug"></span>

        <h1>abiturient</h1>
        <form id="abiturient-form">
            <input type="submit"></input>
        </form>
        <br>
        response: <span id="abiturient-info"></span><br>
        success: <span id="abiturient-success"></span><br>

        <h1>subjects</h1>
        <form id="subjects-form">
            <input type="submit"></input>
        </form>
        <br>
        response: <span id="subjects-list"></span><br>
        success: <span id="subjects-success"></span><br>

        <h1>specialties</h1>
        <form id="specialties-form">
            <input type="submit"></input>
        </form>
        <br>
        response: <span id="specialties-list"></span><br>
        success: <span id="specialties-success"></span><br>

        <h1>universities</h1>
        <form id="universities-form">
            <input type="submit"></input>
        </form>
        <br>
        response: <span id="universities-list"></span><br>
        success: <span id="universities-success"></span><br>

        <script>
	 function submit_login(e) {
	     e.preventDefault(); //чтобы не рефрешило страницу 
	     var req = new XMLHttpRequest();
	     var result;
	     req.onreadystatechange = function () {
		 if (this.readyState === 4) {
                     if (this.status === 200) {
                         $('#debug').text(this.responseText);
		         result = JSON.parse(this.responseText);
		         $('#role').text(result.role);
                         $('#abiturient_id').text(result.abiturient_id);

                         $('#login-success').text("success");
                     } else {
                         $('#role').text(this.responseText);
                         $('#login-success').text("failed");
                     }
		 };
	     };

	     req.open('POST', '/login', true);
	     req.setRequestHeader("Content-Type", "application/json");
             login_data = { username: $('#login').val(), password: $('#password').val(), };
             $("#debug").text(JSON.stringify(login_data));
	     req.send(JSON.stringify(login_data));
	     console.log($('#request').text());
	     return false;
	 };

	 function submit_abiturient(e) {
	     e.preventDefault(); //чтобы не рефрешило страницу 
	     var req = new XMLHttpRequest();
	     var result;
	     req.onreadystatechange = function () {
		 if (this.readyState === 4) {
                     if (this.status === 200) {
                         $('#abiturient-info').text(this.responseText);
                         $('#abiturient-success').text("success");
                     } else {
                         $('#abiturient-success').text("failed " + this.responseText);
                     }
		 };
	     };

	     req.open('GET', '/abiturient', true);
	     req.send();
	     return false;
	 };

	 function submit_subjects(e) {
	     e.preventDefault(); //чтобы не рефрешило страницу 
	     var req = new XMLHttpRequest();
	     var result;
	     req.onreadystatechange = function () {
		 if (this.readyState === 4) {
                     if (this.status === 200) {
                         $('#subjects-list').text(this.responseText);
                         $('#subjects-success').text("success");
                     } else {
                         $('#subjects-success').text("failed " + this.responseText);
                     }
		 };
	     };

	     req.open('GET', '/subjects', true);
	     req.send();
	     return false;
	 };

	 function submit_specialties(e) {
	     e.preventDefault(); //чтобы не рефрешило страницу 
	     var req = new XMLHttpRequest();
	     var result;
	     req.onreadystatechange = function () {
		 if (this.readyState === 4) {
                     if (this.status === 200) {
                         $('#specialties-list').text(this.responseText);
                         $('#specialties-success').text("success");
                     } else {
                         $('#specialties-success').text("failed " + this.responseText);
                     }
		 };
	     };

	     req.open('GET', '/specialties', true);
	     req.send();
	     return false;
	 };

	 function submit_universities(e) {
	     e.preventDefault(); //чтобы не рефрешило страницу 
	     var req = new XMLHttpRequest();
	     var result;
	     req.onreadystatechange = function () {
		 if (this.readyState === 4) {
                     if (this.status === 200) {
                         $('#universities-list').text(this.responseText);
                         $('#universities-success').text("success");
                     } else {
                         $('#universities-success').text("failed " + this.responseText);
                     }
		 };
	     };

	     req.open('GET', '/universities', true);
	     req.send();
	     return false;
	 };

	 $('#login-form').on('submit', submit_login);
	 $('#abiturient-form').on('submit', submit_abiturient);
	 $('#subjects-form').on('submit', submit_subjects);
	 $('#specialties-form').on('submit', submit_specialties);
	 $('#universities-form').on('submit', submit_universities);
        </script>
    </body>
</html>
